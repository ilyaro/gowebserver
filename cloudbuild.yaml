timeout: 1200s
i#substitutions:

steps:

## multiline script
- name: golang:1.20.3
  entrypoint: /bin/bash
  args: 
    - -c
    - |
      pwd; GO_ENABLED=0 GOOS=linux go build webserver.go 

## build the image of webserver and push it in the same runtime image docker in docker to google container registry gcr.io 
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/gowebserver-1/webserver', '.']
images: ['gcr.io/gowebserver-1/webserver']

## deploy withj gke-deploy image
#- name: "gcr.io/cloud-builders/gke-deploy"
#  args:
#  - run
#  - --filename=./webserverchart
#  - --image=gcr.io/project-id/image:tag
#  - --location=location
#  - --cluster=cluster

- name: gcr.io/gowebserver-1/helm
  id: Deploy chart
  args:
    - upgrade
    - -i
    - 
    - ./webserverchart
    - -f
    - ./webserverchart/values.yaml
  env:
    - KUBECONFIG=/workspace/.kube/config
      - TILLERLESS=true
